<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste Específico - Filtros Concluídas e Em Andamento</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .button {
        background: #4f46e5;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        margin: 10px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s;
      }
      .button:hover {
        background: #3730a3;
        transform: translateY(-2px);
      }
      .button.active {
        background: #059669;
      }
      .results {
        margin-top: 20px;
        padding: 15px;
        background: #f0f9ff;
        border-left: 4px solid #0ea5e9;
        border-radius: 4px;
      }
      .task-item {
        background: #f8fafc;
        padding: 10px;
        margin: 5px 0;
        border-radius: 6px;
        border-left: 4px solid #e2e8f0;
      }
      .task-completed {
        border-left-color: #10b981;
        background: #ecfdf5;
      }
      .task-in-progress {
        border-left-color: #3b82f6;
        background: #eff6ff;
      }
      .task-pending {
        border-left-color: #f59e0b;
        background: #fffbeb;
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .stat-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
      }
      .count {
        font-size: 2em;
        font-weight: bold;
        margin: 10px 0;
      }
      .count.completed {
        color: #10b981;
      }
      .count.in-progress {
        color: #3b82f6;
      }
      .count.pending {
        color: #f59e0b;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🧪 Teste Específico: Filtros de Atividades</h1>
      <p>
        Testando especificamente os filtros de <strong>Concluídas</strong> e
        <strong>Em Andamento</strong>
      </p>

      <div>
        <button class="button" onclick="loadAllTasks()">
          Carregar Todas as Tarefas
        </button>
        <button class="button" onclick="filterCompleted()">
          Filtrar Concluídas (100%)
        </button>
        <button class="button" onclick="filterInProgress()">
          Filtrar Em Andamento (1-99%)
        </button>
        <button class="button" onclick="filterPending()">
          Filtrar Pendentes (0%)
        </button>
        <button class="button" onclick="clearFilter()">Limpar Filtros</button>
      </div>

      <div class="stats" id="stats">
        <div class="stat-card">
          <div>Total de Tarefas</div>
          <div class="count" id="totalCount">0</div>
        </div>
        <div class="stat-card">
          <div>Concluídas (100%)</div>
          <div class="count completed" id="completedCount">0</div>
        </div>
        <div class="stat-card">
          <div>Em Andamento (1-99%)</div>
          <div class="count in-progress" id="inProgressCount">0</div>
        </div>
        <div class="stat-card">
          <div>Pendentes (0%)</div>
          <div class="count pending" id="pendingCount">0</div>
        </div>
      </div>

      <div class="results" id="results">
        <p>Clique em "Carregar Todas as Tarefas" para começar o teste</p>
      </div>
    </div>

    <script>
      let allTasks = [];
      let currentFilter = 'all';

      async function loadAllTasks() {
        try {
          const response = await fetch('http://localhost:3000/cronograma.csv');
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const csvText = await response.text();
          allTasks = parseCSV(csvText);

          updateStats();
          displayTasks(allTasks);
          currentFilter = 'all';
          updateResults(
            `Carregadas ${allTasks.length} tarefas do cronograma PFUS3`
          );
        } catch (error) {
          updateResults(`Erro ao carregar dados: ${error.message}`);
        }
      }

      function parseCSV(csvText) {
        const lines = csvText.split('\n');
        const tasks = [];

        for (let i = 1; i < lines.length; i++) {
          const line = lines[i].trim();
          if (!line) continue;

          const columns = line.split(',');
          if (columns.length < 3) continue;

          const percentComplete = parseFloat(columns[2]?.replace('%', '')) || 0;
          const taskName = columns[1];

          if (taskName && taskName.length > 2) {
            tasks.push({
              id: columns[0],
              nome: taskName,
              percentualCompleto: percentComplete,
              inicio: columns[6],
              fim: columns[7],
            });
          }
        }

        return tasks;
      }

      function updateStats() {
        const total = allTasks.length;
        const completed = allTasks.filter(
          (task) => task.percentualCompleto === 100
        ).length;
        const inProgress = allTasks.filter(
          (task) => task.percentualCompleto > 0 && task.percentualCompleto < 100
        ).length;
        const pending = allTasks.filter(
          (task) => task.percentualCompleto === 0
        ).length;

        document.getElementById('totalCount').textContent = total;
        document.getElementById('completedCount').textContent = completed;
        document.getElementById('inProgressCount').textContent = inProgress;
        document.getElementById('pendingCount').textContent = pending;
      }

      function filterCompleted() {
        const filtered = allTasks.filter(
          (task) => task.percentualCompleto === 100
        );
        displayTasks(filtered);
        currentFilter = 'completed';
        updateResults(
          `Filtro CONCLUÍDAS: ${filtered.length} tarefas com 100% de conclusão`
        );
      }

      function filterInProgress() {
        const filtered = allTasks.filter(
          (task) => task.percentualCompleto > 0 && task.percentualCompleto < 100
        );
        displayTasks(filtered);
        currentFilter = 'in-progress';
        updateResults(
          `Filtro EM ANDAMENTO: ${filtered.length} tarefas com 1-99% de conclusão`
        );
      }

      function filterPending() {
        const filtered = allTasks.filter(
          (task) => task.percentualCompleto === 0
        );
        displayTasks(filtered);
        currentFilter = 'pending';
        updateResults(
          `Filtro PENDENTES: ${filtered.length} tarefas com 0% de conclusão`
        );
      }

      function clearFilter() {
        displayTasks(allTasks);
        currentFilter = 'all';
        updateResults(
          `Filtros limpos: Exibindo todas as ${allTasks.length} tarefas`
        );
      }

      function displayTasks(tasks) {
        const resultsDiv = document.getElementById('results');

        if (tasks.length === 0) {
          resultsDiv.innerHTML =
            '<p>Nenhuma tarefa encontrada para este filtro</p>';
          return;
        }

        let html = `<h3>Tarefas Exibidas (${tasks.length}):</h3>`;

        tasks.slice(0, 10).forEach((task) => {
          let className = 'task-item';
          if (task.percentualCompleto === 100) {
            className += ' task-completed';
          } else if (task.percentualCompleto > 0) {
            className += ' task-in-progress';
          } else {
            className += ' task-pending';
          }

          html += `
                    <div class="${className}">
                        <strong>${task.nome}</strong><br>
                        <small>Progresso: ${task.percentualCompleto}% | ID: ${task.id}</small>
                    </div>
                `;
        });

        if (tasks.length > 10) {
          html += `<p><em>... e mais ${tasks.length - 10} tarefas</em></p>`;
        }

        resultsDiv.innerHTML = html;
      }

      function updateResults(message) {
        const timestamp = new Date().toLocaleTimeString();
        console.log(`[${timestamp}] ${message}`);
      }

      // Teste automático ao carregar a página
      window.addEventListener('load', () => {
        console.log('🚀 Teste de Filtros Iniciado');
        console.log('📊 Verificando conexão com o servidor React...');
      });
    </script>
  </body>
</html>
